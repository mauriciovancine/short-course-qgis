---
title: "Introdução ao uso de dados geoespaciais no R <br><br><br>"
subtitle: "5 Estrutura e manipulação de dados matriciais <br><br><br>"
author: "Maurício H. Vancine"
date: "19/06/2021"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts, custom.css]
    lib_dir: libs
    nature:
      highlightStyle: rainbow
      highlightLines: false
      highlightSpans: true
      countIncrementalSlides: false
      ratio: "16:9"
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE, encoding = "UTF-8")
knitr::opts_chunk$set(fig.retina = 3, 
                      fig.align = 'center', 
                      #fig.height = 3,
                      out.width = '30%',
                      eval = TRUE,
                      warning = FALSE, 
                      message = FALSE)
if(!require(raster)) install.packages("raster")
if(!require(sf)) install.packages("sf")
if(!require(tidyverse)) install.packages("tidyverse")
if(!require(geobr)) install.packages("geobr")
if(!require(rnaturalearth)) install.packages("rnaturalearth")
```

class: clear
background-image: url(img/geo_raster_wd.png)
background-size: 800px

---

name: contents-slide

background-image: url(img/r_spatial.jpeg)
background-size: 400px
background-position: 80% 65%

# 5 Estrutura e manejo de dados raster

## Tópicos

<br>

[5.1 Principais pacotes](#1.) <br>
[5.2 Classes *raster*](#2.) <br>
[5.3 Importar dados matriciais (raster)](#3.) <br>
[5.4 Descrição de objetos *raster*](#4.) <br>
[5.5 Converter CRS de objetos *raster*](#5.) <br>
[5.6 Operações de objetos *raster*](#6.) <br>
[5.7 Interação raster-vetor](#7.) <br>
[5.8 Conversão raster-vetor](#8.) <br>
[5.9 Índices espectrais](#9.) <br>
[5.10 Exportar dados matriciais](#10.) <br>

---

# 5 Estrutura e manejo de dados raster

## Script

<br><br><br><br>

## .center[`05_script_intro_geocomp_r.R`]

---

name: 1.

class: inverse, center, middle

# 5.1 Principais pacotes

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

background-image: url(img/geo_raster_package.png)
background-size: 650px
background-position: 50% 70%

# 5.1 Principais pacotes

## Pacote *raster*

```{r eval=FALSE}
# raster
install.packages("raster")
library(raster)
```

<br><br><br><br><br><br><br><br><br><br><br>

[*] https://rspatial.org/raster/pkg/

---

background-image: url(img/geo_terra_package.png)
background-size: 650px
background-position: 50% 70%

# 5.1 Principais pacotes

## Pacote *terra*

```{r eval=FALSE}
# raster
install.packages("terra")
library(terra)
```

<br><br><br><br><br><br><br><br><br><br><br>

[*] https://rspatial.org/terra/pkg/

---

background-image: url(img/geo_raster_stars.png)
background-size: 500px
background-position: 50% 70%

# 5.1 Principais pacotes

## Pacote *stars*

```{r eval=FALSE}
# raster
install.packages("stars")
library(stars)
```

<br><br><br><br><br><br><br><br><br><br><br>

[*] https://r-spatial.github.io/stars/

---

name: 2.

class: inverse, center, middle

# 5.2 Classes *raster*

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

background-image: url(img/geo_raster.png)
background-size: 500px
background-position: 50% 90%

# 5.2 Classes *raster*

## Raster ou Gride ou Dado Matricial (matriz)

---

background-image: url(img/geo_raster_cont_cat.png)
background-size: 700px
background-position: 50% 70%

# 5.2 Classes *raster*

## Tipos de dados: contínuos ou categóricos

---

background-image: url(img/geo_raster_plot.png)
background-size: 1000px
background-position: 50% 70%

# 5.2 Classes *raster*

## Valores

---

background-image: url(img/geo_raster_single_multi_raster.png)
background-size: 800px
background-position: 50% 70%

# 5.2 Classes *raster*

## RasterLayer, RasterStack ou RasterBrick

---

background-image: url(img/geo_raster_single_raster.png)
background-size: 400px
background-position: 50% 80%

# 5.2 Classes *raster*

## RasterLayer

### A classe **RasterLayer** representa apenas uma camada raster

---

# 5.2 Classes *raster*

## RasterLayer

### A classe **RasterLayer** representa apenas uma camada raster

```{r}
# volcano
volcano
```

---

# 5.2 Classes *raster*

## RasterLayer

### A classe **RasterLayer** representa apenas uma camada raster

```{r}
# raster layer
ra_layer <- raster::raster(volcano)
ra_layer
```

---

# 5.2 Classes *raster*

## RasterLayer

### A classe **RasterLayer** representa apenas uma camada raster

```{r}
# plot
plot(ra_layer)
```

---

# 5.2 Classes *raster*

## RasterLayer

### A classe **RasterLayer** representa apenas uma camada raster

```{r}
# plot
plot(ra_layer, col = viridis::viridis(10))
```

---

# 5.2 Classes *raster*

## RasterLayer

### A classe **RasterLayer** representa apenas uma camada raster

```{r}
# plot
plot(ra_layer, col = viridis::viridis(100))
```

---

background-image: url(img/geo_raster_multi_raster.png)
background-size: 400px
background-position: 50% 90%

# 5.2 Classes *raster*

## RasterStack

### A classe **RasterStack** é uma lista de **RasterLayer** com extensão e resolução iguais

---

# 5.2 Classes *raster*

## RasterStack

```{r}
# raster stack
ra_layer1 <- ra_layer
ra_layer2 <- ra_layer * ra_layer
ra_layer3 <- sqrt(ra_layer)
ra_layer4 <- log10(ra_layer)

ra_stack <- raster::stack(ra_layer1, 
                          ra_layer2, 
                          ra_layer3, 
                          ra_layer4)
ra_stack
```

---

# 5.2 Classes *raster*

## RasterStack

```{r fig.width=10, fig.height=5, out.height='60%', out.width='60%'}
# plot
plot(ra_stack, col = viridis::viridis(100))
```

---

background-image: url(img/geo_raster_multi_raster.png)
background-size: 400px
background-position: 50% 90%

# 5.2 Classes *raster*

## RasterBrick

### A classe **RasterStack** é uma lista de **RasterLayer** com extensão e resolução iguais

---

background-image: url(img/geo_raster_brick.jpg)
background-size: 700px
background-position: 50% 90%

# 5.2 Classes *raster*

## RasterBrick

### A principal diferença entre **RasterStack** e **RasterBrick** é que o segundo é vinculado a um **único arquivo (multicamadas)**

---

# 5.2 Classes *raster*

## RasterBrick

```{r}
# raster brick
ra_layer1 <- ra_layer
ra_layer2 <- ra_layer * ra_layer
ra_layer3 <- sqrt(ra_layer)
ra_layer4 <- log10(ra_layer)

ra_brick <- raster::brick(ra_layer1, 
                          ra_layer2, 
                          ra_layer3, 
                          ra_layer4)
ra_brick
```

---

# 5.2 Classes *raster*

## RasterBrick

```{r fig.width=10, fig.height=5, out.height='60%', out.width='60%'}
# plot
plot(ra_brick, col = viridis::viridis(100))
```

---

name: 3.

class: inverse, center, middle

# 5.3 Importar dados matriciais (raster)

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

background-image: url(img/geo_raster_dem01.png), url(img/geo_raster_dem02.png)
background-size: 340px,350px
background-position: 20% 90%, 80% 90%

# 5.3 Importar dados matriciais (raster)

## Dados de elevação

### Modelo Digital de Elevação (DEM) ou Superfície (DSM)

---

background-image: url(img/geo_raster_srtm01.png), url(img/geo_raster_srtm02.png), url(img/geo_raster_srtm03.png)
background-size: 400px, 300px, 320px
background-position: 15% 90%, 60% 50%, 90% 85%

# 5.3 Importar dados matriciais (raster)

## Dados de elevação

### SRTM

> - Farr, Tom G. et al. ["The Shuttle Radar Topography Mission."](https://doi.org/10.1002/joc.5086) Reviews of Geophysics 45.2 (2007): 1.

---

# 5.3 Importar dados matriciais (raster)

## Importar uma camada

### RasterLayer

```{r}
# importar raster
ra <- raster::raster(here::here("04_dados", "03_raster", "srtm_27_17.tif"))
ra
```

---

# 5.3 Importar dados matriciais (raster)

## Importar uma camada

### Rio Claro/SP

```{r}
# rio claro
rc_2019 <- geobr::read_municipality(code_muni = 3543907, year = 2019, showProgress = FALSE) %>% 
  sf::st_transform(crs = 4326)
rc_2019
```

---

# 5.3 Importar dados matriciais (raster)

## Importar uma camada

### RasterLayer

```{r}
# plot
plot(ra, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

background-image: url(img/geo_raster_crop_mask_buffer_square.png)
background-size: 700px
background-position: 50% 80%

# 5.3 Importar dados matriciais (raster)

## Importar uma camada

### Ajuste do limite do RasterLayer

---

# 5.3 Importar dados matriciais (raster)

## Importar uma camada

### Ajuste do limite do RasterLayer

```{r}
# ajuste do limite
ra_rc <- raster::crop(ra, rc_2019)
ra_rc
```

---

# 5.3 Importar dados matriciais (raster)

## Importar uma camada

### Ajuste do limite do RasterLayer

```{r}
# plot
plot(ra_rc, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

background-image: url(img/geo_raster_wc_artigo.png)
background-size: 600px
background-position: 50% 90%

# 5.3 Importar dados matriciais (raster)

## O que é o WorldClim?

- Principal bases de **dados climáticos** para o mundo
- Dados temporais de **temperatura e precipitação**
- Construído a partir de dados de **estações meteorológicas, interpolação e topografia**
- Principal forma de uso: **variáveis bioclimáticas**

> - Fick, Stephen E., Hijmans, Robert J. ["WorldClim 2: new 1‐km spatial resolution climate surfaces for global land areas."](https://doi.org/10.1002/joc.5086) International Journal of Climatology 37.12 (2017): 4302.

---

background-image: url(img/geo_raster_wc_mapas.png), url(img/geo_raster_wc_method.png), url(img/geo_raster_wc_interpolation.png)
background-size: 400px, 280px, 470px
background-position: 5% 75%, 48% 55%, 97% 75%

# 5.3 Importar dados matriciais (raster)

## Estações meteorológicas e interpolação

---

background-image: url(img/geo_raster_bioclim.png)
background-size: 570px
background-position: 50% 90%

# 5.3 Importar dados matriciais (raster)

## Variáveis bioclimáticas

- São **19 variáveis** relacionadas com a **biologia das organismos**

- Combinações temporais de **temperatura (BIO01-BIO11)** e **precipitação (BIO12-BIO19)**

---

background-image: url(img/geo_raster_bio01.png)
background-size: 1000px
background-position: 50% 80%

# 5.3 Importar dados matriciais (raster)

## Variáveis bioclimáticas

### BIO01: Temperatura média anual (º C)

---

background-image: url(img/geo_raster_merraclim.jpg)
background-size: 1000px
background-position: 50% 75%

# 5.3 Importar dados matriciais (raster)

## Variáveis Bioclimáticas

### Disponível em **várias resoluções** e **períodos (passado, presente e futuro)**

---

background-image: url(img/geo_raster_worldclim.png)
background-size: 800px
background-position: 50% 55%

# 5.3 Importar dados matriciais (raster)

## Site

<br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://www.worldclim.org/

---

# 5.3 Importar dados matriciais (raster)

## Importar várias camadas

### Listar arquivos

```{r}
# listar arquivos
fi <- dir(path = here::here("04_dados", "03_raster"), pattern = "wc", full.names = TRUE) %>% 
  grep(".tif", ., value = TRUE)
fi
```

---

# 5.3 Importar dados matriciais (raster)

## Importar várias camadas

### RasterStack

```{r}
# importar
st <- raster::stack(fi)
st
```

---

# 5.3 Importar dados matriciais (raster)

## Importar várias camadas

### RasterStack

```{r fig.width=10, fig.height=5, out.height='60%', out.width='60%'}
# plot
plot(st[[1:2]], col = viridis::viridis(10))
```

---

background-image: url(img/geo_landsat.jpg)
background-size: 600px
background-position: 50% 80%

# 5.3 Importar dados matriciais (raster)

## Imagens de satélite

### Landsat

- Série de satélites dedicado exclusivamente à observação dos **recursos naturais terrestres**, desenvolvido pela NASA

---

background-image: url(img/geo_landsat_missions.jpg)
background-size: 600px
background-position: 50% 80%

# 5.3 Importar dados matriciais (raster)

## Imagens de satélite

### Landsat - Missões

---

background-image: url(img/geo_sr_landsat8.png), url(img/geo_rs_spectrum_satelites_landsat.png), url(img/geo_landsat_composition_bands.png)
background-size: 250px, 650px, 500px
background-position: 10% 35%, 4% 99%, 95% 75%

# 5.3 Importar dados matriciais (raster)

## Imagens de satélite

### Landsat 8 - Bandas

---

background-image: url(img/geo_sr_landsat8.png), url(img/geo_rs_bands.jpg)
background-size: 300px, 600px
background-position: 90% 20%, 50% 80%

# 5.3 Importar dados matriciais (raster)

## Imagens de satélite

### Landsat 8 - Bandas como camadas

---

# 5.3 Importar dados matriciais (raster)

## Importar várias camadas

### RasterBrick

```{r}
# importar
landsat_rc <- raster::brick(here::here("04_dados", "04_imagem", "landsat_rc.tif"))
landsat_rc
```

---

# 5.3 Importar dados matriciais (raster)

## Importar várias camadas

### RasterBrick

```{r}
# plot
plot(landsat_rc$landsat_rc.2)
```

---

# 5.3 Importar dados matriciais (raster)

## Importar várias camadas

### RasterBrick

```{r}
# plot - cores naturais
plotRGB(landsat_rc, r = 4, g = 3, b = 2, stretch = "hist")
```

---

# 5.3 Importar dados matriciais (raster)

## Importar várias camadas

### RasterBrick

```{r}
# plot - falsa cor infravermelho
plotRGB(landsat_rc, r = 5, g = 4, b = 3, stretch = "hist")
```

---

# 5.3 Importar dados matriciais (raster)

## Importar várias camadas

### RasterBrick

```{r}
# plot - cores naturais simuladas
plotRGB(landsat_rc, r = 7, g = 6, b = 4, stretch = "hist")
```

---

# 5.3 Importar dados matriciais (raster)

## Importar várias camadas

### RasterBrick

```{r}
# plot - cores naturais simuladas
plotRGB(landsat_rc, r = 6, g = 5, b = 4, stretch = "hist")
```

---

# 5.3 Importar dados matriciais (raster)

## Importar várias camadas

### RasterBrick

```{r}
# plot - cores naturais simuladas
plotRGB(landsat_rc, r = 7, g = 5, b = 3, stretch = "hist")
```

---

name: 4.

class: inverse, center, middle

# 5.4 Descrição de objetos *raster*

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

# 5.4 Descrição de objetos *raster*

## Informações geográficas

```{r}
# rio claro
ra_rc
```

- *class*: classe raster do objeto
- *dimensions*: número de linhas, colunas, células e camadas
- *resolution*: largura e altura da célula
- *extent*: coordenadas mínimas e máximas da longitude e latitude
- *crs*: Sistema de Referência de Coordenadas
- *source*: fonte dos dados (memória ou disco)
- *names*: nome das camadas
- *values*: valores máximos e mínimos das células

---

# 5.4 Descrição de objetos *raster*

## Informações geográficas

#### Classe

```{r}
# classe
class(ra_rc)
```

--

#### Dimensões

```{r}
# dimensoes
dim(ra_rc)
```

--

#### Número de camadas

```{r}
# numero de camadas
nlayers(ra_rc)
```

---

background-image: url(img/geo_raster.png)
background-size: 450px
background-position: 50% 90%

# 5.4 Descrição de objetos *raster*

## Informações geográficas

### Número de linhas, colunas e células

---

# 5.4 Descrição de objetos *raster*

## Informações geográficas

#### Número de linhas

```{r}
# numero de linhas
nrow(ra_rc)
```

--

#### Número de colunas

```{r}
# numero de colunas
ncol(ra_rc)
```

--

#### Número de células

```{r}
# numero de celulas
ncell(ra_rc)
```

---

background-image: url(img/geo_raster_resolution.png)
background-size: 650px
background-position: 50% 80%

# 5.4 Descrição de objetos *raster*

## Informações geográficas

### Resolução

---

# 5.4 Descrição de objetos *raster*

## Informações geográficas

### Resolução

```{r}
# resolucao do raster
res(ra_rc)
```

--

```{r}
# resolucao do stack
res(st)
```

---

background-image: url(img/geo_raster_extent.png)
background-size: 600px
background-position: 50% 90%

# 5.4 Descrição de objetos *raster*

## Informações geográficas

### Extensão

---

# 5.4 Descrição de objetos *raster*

## Informações geográficas

### Extensão

```{r}
# extensao do raster
extent(ra_rc)
```

--

```{r}
# extensao do stack
extent(st)
```

---

# 5.4 Descrição de objetos *raster*

## Informações geográficas

### Projeção

```{r}
# projecao
projection(ra_rc)
```

--

```{r}
# projecao
projection(st)
```

---

# 5.4 Descrição de objetos *raster*

## Informações geográficas

### Nomes

```{r}
# nomes da camada do raster
names(ra_rc)
```

--

```{r}
# nomes das camadas do stack
names(st)
```

---

background-image: url(img/geo_raster_values.gif)
background-size: 650px
background-position: 50% 90%

# 5.4 Descrição de objetos *raster*

## Informações geográficas

### Valores

---

# 5.4 Descrição de objetos *raster*

## Informações geográficas

### Valores

```{r}
# valores do raster
getValues(ra_rc) %>% head()
```

--

```{r}
# valores do raster
values(ra_rc) %>% head()
```

--

```{r}
# valores do raster
ra_rc[] %>% head()
```

---

# 5.4 Descrição de objetos *raster*

## Informações geográficas

### Valores

```{r out.width='25%'}
# valores do raster - histograma
ra_rc %>% 
  raster::values() %>% 
  hist(col = "steelblue", border = "white", main = NA, xlab = "Elevação (m)", ylab = "Frequência")
```

---

# 5.4 Descrição de objetos *raster*

## Informações geográficas

### Valores

```{r}
# valores do stack
values(st[[1:3]]) %>% head()
```

---

# 5.4 Descrição de objetos *raster*

## Informações geográficas

### Valores

```{r out.width='25%'}
# valores do stack - grafico pareado
st[[1:3]] %>% 
  raster::values() %>% 
  tibble::as_tibble() %>% 
  dplyr::sample_n(1e3) %>% 
  pairs(cex = 1.4, pch = 20, col = adjustcolor("steelblue", .7))
```

---

name: 5.

class: inverse, center, middle

# 5.5 Converter CRS de objetos *raster*

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

background-image: url(img/geo_raster_reprojection.png)
background-size: 550px
background-position: 50% 70%

# 5.5 Converter CRS de objetos *raster*

## Reprojeção

---

background-image: url(img/geo_raster_crs.png)
background-size: 800px
background-position: 50% 90%

# 5.5 Converter CRS de objetos *raster*

## Reprojeção

1. Reprojeção vetorial de centroides celulares (muda a **posição e tamanho** do pixel)
1. Cálculo de novos valores dos pixels por meio de reamostragem (muda o **valor** do pixel)

---

# 5.5 Converter CRS de objetos *raster*

## Converter CRS local

### WGS84/GCS -> SIRGAS2000/UTM23s (proj4string)

```{r}
# projecao do raster
raster::projection(ra_rc)
raster::crs(ra_rc)
```

---

background-image: url(img/geo_utm_zones.png)
background-size: 500px
background-position: 50% 70%

# 5.5 Converter CRS de objetos *raster*

## Converter CRS local

### WGS84/GCS -> SIRGAS2000/UTM23s (proj4string)

```{r}
# proj4string utm 23s
utm23s <- "+init=epsg:31983"
```

<br><br><br><br><br><br><br><br>

[*] https://epsg.io/31983

[*] https://pro.arcgis.com/en/pro-app/help/mapping/properties/transverse-mercator.htm

---

# 5.5 Converter CRS de objetos *raster*

## Converter CRS local

### WGS84/GCS -> SIRGAS2000/UTM23s (proj4string)

```{r}
# reprojecao
ra_rc_utm23s <- raster::projectRaster(ra_rc, crs = utm23s)
ra_rc_utm23s
```

---

# 5.5 Converter CRS de objetos *raster*

## Converter CRS local - especificando parâmetros

### WGS84/GCS -> SIRGAS2000/UTM23s (proj4string)

```{r}
# reprojecao
ra_rc_utm23s <- raster::projectRaster(ra_rc, crs = utm23s, res = 90, method = "bilinear")
ra_rc_utm23s
```

---

# 5.5 Converter CRS de objetos *raster*

## Converter CRS local - especificando parâmetros

### WGS84/GCS -> SIRGAS2000/UTM23s (proj4string)

```{r}
# reprojecao de vector
rc_2019_utm23s <- sf::st_transform(rc_2019, crs = utm23s)
rc_2019_utm23s
```

---

# 5.5 Converter CRS de objetos *raster*

## Converter CRS local

### WGS84/GCS -> SIRGAS2000/UTM23s (proj4string)

```{r}
# plot
plot(ra_rc_utm23s, col = viridis::viridis(10))
plot(rc_2019_utm23s$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 5.5 Converter CRS de objetos *raster*

## Converter CRS global

### Datum WGS84 e coordenadas geográficas

```{r}
# WGS84/GCS
st$wc2.1_10m_bio_1
```

---

# 5.5 Converter CRS de objetos *raster*

## Converter CRS global

### Datum WGS84 e coordenadas geográficas

```{r}
# plot
plot(st$wc2.1_10m_bio_1, col = viridis::viridis(10))
```

---

background-image: url(img/geo_proj_moll.png)
background-size: 500px
background-position: 50% 70%

# 5.5 Converter CRS de objetos *raster*

## Converter CRS global

### Projeção de Mollweide: preserva as relações de área

```{r}
# proj4string mollweide
moll <- "+proj=moll"
```

<br><br><br><br><br><br><br><br>

[*] https://epsg.io/54009

[*] https://pro.arcgis.com/en/pro-app/help/mapping/properties/mollweide.htm

---

# 5.5 Converter CRS de objetos *raster*

## Converter CRS global

### Projeção de Mollweide

```{r}
# reprojecao
bio01_moll <- raster::projectRaster(st$wc2.1_10m_bio_1, crs = moll, res = 25e3, method = "bilinear")
bio01_moll
```

---

# 5.5 Converter CRS de objetos *raster*

## Converter CRS global

### Projeção de Mollweide

```{r}
# plot
plot(bio01_moll, col = viridis::viridis(10))
```

---

background-image: url(img/geo_proj_laea.png)
background-size: 280px
background-position: 50% 75%

# 5.5 Converter CRS de objetos *raster*

## Converter CRS global

### Projeção Azimutal de Lambert: preserva os tamanhos e senso de direção (centro)

```{r}
# proj4string lambert 
laea <- "+proj=laea +x_0=0 +y_0=0 +lon_0=0 +lat_0=0"
```

<br><br><br><br><br><br><br><br><br><br>

[*] https://pro.arcgis.com/en/pro-app/help/mapping/properties/lambert-azimuthal-equal-area.htm

---

# 5.5 Converter CRS de objetos *raster*

## Converter CRS global

### Projeção Azimutal de Lambert: preserva os tamanhos e senso de direção (centro)

```{r}
# reprojecao
bio01_laea <- raster::projectRaster(st$wc2.1_10m_bio_1, crs = laea, res = 25e3, method = "bilinear")
bio01_laea
```

---

# 5.5 Converter CRS de objetos *raster*

## Converter CRS global

### Projeção Azimutal de Lambert: preserva os tamanhos e senso de direção (centro)

```{r}
# plot
plot(bio01_laea, col = viridis::viridis(10))
```

---

name: 6.

class: inverse, center, middle

# 5.6 Operações de objetos *raster*

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

background-image: url(img/geo_raster_focal.png), url(img/geo_raster_aggregate.png)
background-size: 450px, 460px
background-position: 15% 90%, 85% 90%

# 5.6 Operações de objetos *raster*

## As operações podem ser separadas em três tipos

### 1. **Operações de atributos** (acessar valores, camadas e nome das camadas)
### 2. **Operações espaciais** (aplicar regras espaciais para mudar valores dos pixels)
### 3. **Operações geométricas** (mudar a posição, tamanho e número dos pixels)

---

background-image: url(img/geo_raster_values.png)
background-size: 600px
background-position: 95% 105%

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### Modificação de objetos *raster* baseado em **informações não espaciais**, como **valores das células e nome das camadas**

### **Operações**

### 1. Subconjunto de células ou camadas
### 2. Renomear nomes das camadas
### 3. Resumir informações dos pixels

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.1 Subconjunto - Seleção de valores

```{r}
# raster - linha 1 e coluna 1
ra[1, 1]
```

--

```{r}
# celula 1
ra[1]
```

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.1 Subconjunto - Seleção de valores

```{r}
# stack - linha 1 e coluna 1
st[1, 1]
```

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.1 Subconjunto - Seleção de valores

```{r}
# celula 1
st[1]
```

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.1 Subconjunto - Seleção de camadas

```{r}
# selecao de camada num objeto stack utilizando a funcao subset
st_bio01 <- raster::subset(st, "wc2.1_10m_bio_1")
st_bio01
```

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.1 Subconjunto - Seleção de camadas

```{r}
# selecao de camada num objeto stack utilizando a funcao raster
st_bio01 <- raster::raster(st, layer = 1)
st_bio01
```

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.1 Subconjunto - Seleção de camadas

```{r}
# selecao de camada num objeto stack utilizando os operadores [[]] e o nome
st_bio01 <- st[["wc2.1_10m_bio_1"]]
st_bio01
```

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.1 Subconjunto - Seleção de camadas

```{r}
# selecao de camada num objeto stack utilizando os operadores [[]] e a posicao
st_bio01 <- st[[1]]
st_bio01
```

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.1 Subconjunto - Seleção de camadas

```{r}
# selecao de camada num objeto stack utilizando o operador $
st_bio01 <- st$wc2.1_10m_bio_1
st_bio01
```

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.1 Subconjunto - Seleção de camadas

```{r}
# plot
plot(st_bio01, col = viridis::viridis(10))
```

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.2 Renomear 

```{r}
# nomes
names(ra_rc)
```

--

```{r}
# renomear
names(ra_rc) <- "elevation"
```

--

```{r}
# nomes
names(ra_rc)
```

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.2 Renomear 

```{r}
# nomes
names(st)
```

--

```{r}
# renomear
names(st) <- c("bio01", paste0("bio", 10:19), paste0("bio0", 2:9))
```

--

```{r}
# nomes
names(st)
```

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.3 Resumir - Média

```{r}
# media de todas as celulas de altitude
raster::cellStats(x = ra_rc, stat = mean)
```

--

```{r}
# media de todas as celulas de cada camada bioclimatica
raster::cellStats(x = st, stat = mean)
```

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.3 Resumir - Frequência

```{r}
# frequencia das celulas
raster::freq(x = ra_rc) %>% head()
```

---

# 5.6 Operações de objetos *raster*

## 1 Operações de atributos

### 1.3 Resumir - Frequência

```{r}
# frequencia das celulas
raster::freq(x = st[[1]]) %>% head()
```

---

background-image: url(img/geo_zonal.png)
background-size: 330px
background-position: 85% 85%

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### Aplicação de **regras espaciais** para **mudar valores dos pixels**, geralmente com o intuito de **resumir as informações das células**

<br>

### **Operações**

1. Operações locais (por célula)
1. Operações focais (por bloco de múltiplas células regulares - e.g. 3x3)
1. Operações zonais (por bloco de múltiplas células irregulares)
1. Operações globais (por um ou vários rasters inteiros)

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.1 Operações locais - Álgebra de raster 

```{r}
# soma
ra_rc2 <- ra_rc + ra_rc
ra_rc2
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.1 Operações locais - Álgebra de raster 

```{r}
# plot
plot(ra_rc2, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.1 Operações locais - Álgebra de raster 

```{r}
# log10
ra_rc_log10 <- log10(ra_rc)
ra_rc_log10
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.1 Operações locais - Álgebra de raster 

```{r}
# plot
plot(ra_rc_log10, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.1 Operações locais - Álgebra de raster - Operador lógico

```{r}
# acima de 600
ra_rc_acima_600 <- ra_rc > 600
ra_rc_acima_600
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.1 Operações locais - Álgebra de raster - Operador lógico

```{r}
# plot
plot(ra_rc_acima_600, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.1 Operações locais - Álgebra de raster - Função `calc()`

```{r}
# produto dos pixel - calc
ra_rc_prod <- raster::calc(x = ra_rc, fun = function(x){x * x})
ra_rc_prod 
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.1 Operações locais - Álgebra de raster - Função `calc()`

```{r}
# plot
plot(ra_rc_prod, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

background-image: url(img/geo_raster_reclass.gif)
background-size: 700px
background-position: 50% 75%

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.1 Operações locais - Reclassificação

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.1 Operações locais - Reclassificação

```{r}
# matriz de reclassificacao
rcl  <- matrix(
  c(400, 600, 1, 
    600, 800, 2, 
    800, 1000, 3), 
  ncol = 3, byrow = TRUE)
rcl
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.1 Operações locais - Reclassificação

```{r}
# reclassificao
ra_rc_rcl <- raster::reclassify(x = ra_rc, rcl = rcl)
ra_rc_rcl
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.1 Operações locais - Reclassificação

```{r}
# plot
plot(ra_rc_rcl, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

background-image: url(img/geo_raster_focal.png)
background-size: 700px
background-position: 50% 85%

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.2 Operação focal - Janela móvel (*Moving window*)

---

background-image: url(img/geo_raster_moving_window.gif)
background-size: 450px
background-position: 50% 90%

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.2 Operação focal - Janela móvel (*Moving window*)

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.2 Operação focal - Janela móvel (*Moving window*)

```{r}
# janela movel
ra_rc_focal_sd <- raster::focal(x = ra_rc, w = matrix(data = 1, nrow = 3, ncol = 3), fun = sd)
ra_rc_focal_sd
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.2 Operação focal - Janela móvel (*Moving window*)

```{r}
# plot
plot(ra_rc_focal_sd, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### Declividade (*Slope*)

```{r}
# declividade
ra_rc_dec <- raster::terrain(x = ra_rc, opt = "slope", unit = "degrees")
ra_rc_dec
```

---

background-image: url(img/geo_raster_slope.png), url(img/geo_raster_slope2.jpg), url(img/geo_raster_slope3.png)
background-size: 450px, 450px, 380px
background-position: 80% 10%, 80% 85%, 20% 85%

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### Declividade (*Slope*)

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### Declividade (*Slope*)

```{r}
# plot
plot(ra_rc_dec, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.3 Operações zonais - Estatísticas por zonas

```{r}
# estatistica zonal
ra_rc_zonal <- data.frame(raster::zonal(ra_rc, ra_rc_rcl, fun = "summary"))
ra_rc_zonal
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.3 Operações zonais - Estatísticas por zonas

```{r}
# estatistica zonal
colnames(ra_rc_zonal) <- c("zona", "min", "1qt", "mediana", "media", "3qt", "max")

ra_rc_zonal
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.4 Operações globais - Distância Euclideana

```{r}
# reclassificacao
ra_rc_abaixo_500 <- raster::calc(x = ra_rc, fun = function(x) ifelse(x < 500, 1, NA))
ra_rc_abaixo_500
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.4 Operações globais - Distância Euclideana

```{r}
# plot
plot(ra_rc_abaixo_500, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.4 Operações globais - Distância Euclideana

```{r}
# distancia euclideana
ra_rc_global_dist <- raster::distance(ra_rc_abaixo_500)
ra_rc_global_dist
```

---

# 5.6 Operações de objetos *raster*

## 2 Operações espaciais

### 2.4 Operações globais - Distância Euclideana

```{r}
# plot
plot(ra_rc_global_dist, col = viridis::viridis(10))
plot(ra_rc_abaixo_500, add = TRUE, col = "white", legend = FALSE)
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

background-image: url(img/geo_raster_aggregate2.png)
background-size: 800px
background-position: 85% 70%

# 5.6 Operações de objetos *raster*

## 3 Operações geométricas

### Envolve mudar a **posição, tamanho e número dos pixels** e **atribuir novos valores**, geralmente aumentando ou diminuindo o tamanho desses pixels

<br>

### **Operações**

### 1. Agregação
### 2. Desagregação
### 3. Alinhamento

---

background-image: url(img/geo_raster_resolution_diff.png), url(img/geo_raster_aggregate.png)
background-size: 600px, 350px
background-position: 50% 40%, 50% 95%

# 5.6 Operações de objetos *raster*

## 3 Operações geométricas

### Agregação e desagregação

---

background-image: url(img/geo_raster_long_lat_dist.gif)
background-size: 550px
background-position: 50% 85%

# 5.6 Operações de objetos *raster*

## 3 Operações geométricas

### Resolução - Relação de graus e distância em metros

---

# 5.6 Operações de objetos *raster*

## 3 Operações geométricas

### 3.1 Agregação - Aumentar o tamanho do pixel

```{r}
# resolucao
res(ra_rc_utm23s)[1]

# agregacao - aumentar o tamanho do pixel
ra_rc_utm23s_agre_media <- raster::aggregate(x = ra_rc_utm23s, fact = 10, fun = "mean")
ra_rc_utm23s_agre_media
```

---

# 5.6 Operações de objetos *raster*

## 3 Operações geométricas

### 3.1 Agregação - Aumentar o tamanho do pixel

```{r}
# plot
plot(ra_rc_utm23s_agre_media, col = viridis::viridis(10))
plot(rc_2019_utm23s$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

background-image: url(img/geo_raster_disaggregate.png)
background-size: 700px
background-position: 50% 100%

# 5.6 Operações de objetos *raster*

## 3 Operações geométricas

### 3.2 Desagregação - Diminuir o tamanho do pixel

---

# 5.6 Operações de objetos *raster*

## 3 Operações geométricas

### 3.2 Desagregação - Diminuir o tamanho do pixel

```{r}
# resolucao
res(ra_rc_utm23s)[1]

# desagregacao - diminuir o tamanho do pixel
ra_rc_utm23s_dis_bil <- raster::disaggregate(ra_rc_utm23s, fact = 2, fun = "bilinear")
ra_rc_utm23s_dis_bil
```

---

# 5.6 Operações de objetos *raster*

## 3 Operações geométricas

### 3.2 Desagregação - Diminuir o tamanho do pixel

```{r}
# plot
plot(ra_rc_utm23s_dis_bil, col = viridis::viridis(10))
plot(rc_2019_utm23s$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 5.6 Operações de objetos *raster*

## 3 Operações geométricas

### 3.3 Alinhamento - Ajustar extensão, número e origem dos pixels

```{r}
# reamostragem
st_rc <- raster::resample(x = st$bio01, y = ra_rc, method = "bilinear")
st_rc
```

---

# 5.6 Operações de objetos *raster*

## 3 Operações geométricas

### 3.3 Alinhamento - Ajustar extensão, número e origem dos pixels

```{r}
# plot
plot(st_rc, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

name: 7.

class: inverse, center, middle

# 5.7 Interação raster-vetor

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

background-image: url(img/geo_raster_crop_mask_buffer_square.png),url(img/geo_raster_crop_mask_buffer_circular.png),url(img/geo_zonal.png)
background-size: 400px, 400px, 330px
background-position: 5% 96%, 50% 96%, 90% 70%

# 5.7 Interação raster-vetor

## Podemos fazer operações da **interação entre objetos vetoriais e raster**, com diferentes finalidades, que podem ser diferentes tipos de vetores.

## **Interações**

1. Corte e máscara: ajuste da extensão e limite
1. Extração dos valores dos pixels para vetores
1. Estatísticas zonais para um vetor

---

background-image: url(img/geo_raster_crop_mask.png)
background-size: 1000px
background-position: 50% 85%

# 5.7 Interação raster-vetor

## 1 Cortes e máscaras

### Ajustar o **tamanho de um objeto raster** a uma **área menor de interesse**, geralmente definido por um **objeto vetorial**

---

# 5.7 Interação raster-vetor

## 1 Cortes e máscaras

### Crop - Ajusta a extensão

```{r}
# crop - ajustar da extensao
ra_rc_crop <- raster::crop(ra, rc_2019)
ra_rc_crop
```

---

# 5.7 Interação raster-vetor

## 1 Cortes e máscaras

### Crop - Ajusta a extensão

```{r}
# plot
plot(ra_rc_crop, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 5.7 Interação raster-vetor

## 1 Cortes e máscaras

### Mask - Ajusta o limite

```{r}
# mask - ajuste o limite
ra_rc_mask <- raster::mask(ra, rc_2019)
ra_rc_mask
```

---

# 5.7 Interação raster-vetor

## 1 Cortes e máscaras

### Mask

```{r}
# plot
plot(ra_rc_mask, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 5.7 Interação raster-vetor

## 1 Cortes e máscaras

### Crop e Mask - Ajuste da extensão e do limite

```{r}
# crop e mask - ajuste da extensao e do limite
ra_rc_crop_mask <- ra %>% 
  raster::crop(rc_2019) %>% 
  raster::mask(rc_2019)
ra_rc_crop_mask
```

---

# 5.7 Interação raster-vetor

## 1 Cortes e máscaras

### Crop e Mask - Ajuste da extensão e do limite

```{r}
# plot
plot(ra_rc_crop_mask, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 5.7 Interação raster-vetor

## 1 Cortes e máscaras

### Crop e Mask inverse - Ajuste da extensão e do limite inverso

```{r}
# crop e mask inversa - ajuste da extensão e do limite inverso
ra_rc_crop_mask_inv <- ra %>% 
  raster::crop(rc_2019) %>% 
  raster::mask(rc_2019, inverse = TRUE)
ra_rc_crop_mask_inv
```

---

# 5.7 Interação raster-vetor

## 1 Cortes e máscaras

### Crop e Mask inverse - Ajuste da extensão e do limite inverso

```{r}
# plot
plot(ra_rc_crop_mask_inv, col = viridis::viridis(10))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 5.7 Interação raster-vetor

## 2. Extração

### Importar pontos das nascentes

```{r}
# importar pontos
rc_nas <- sf::st_read(here::here("04_dados", "02_vetor", "SP_3543907_NASCENTES.shp"), quiet = TRUE) %>% 
  sf::st_transform(crs = 4326)
rc_nas
```

---

# 5.7 Interação raster-vetor

## 2. Extração

### Importar pontos das nascentes

```{r}
# plot
plot(rc_nas$geometry, pch = 20, col = "blue", main = NA, axes = TRUE, graticule = TRUE)
```

---

# 5.7 Interação raster-vetor

## 2. Extração

### Extração da altitude para os pontos das nascentes

```{r}
# extracao
rc_nas_ele <- rc_nas %>% 
  dplyr::mutate(elev = raster::extract(x = ra_rc_utm23s, y = .))
rc_nas_ele
```

---

# 5.7 Interação raster-vetor

## 2. Extração

### Extração da altitude para os pontos das nascentes

```{r}
# plot
plot(rc_nas_ele["elev"], pch = 20, main = NA, axes = TRUE, graticule = TRUE)
```

---

# 5.7 Interação raster-vetor

## 2. Extração

### Histograma dos valores

```{r out.width='25%'}
# histograma
rc_nas_ele %>% 
  dplyr::pull(elev) %>% 
  hist(col = "steelblue", border = "white", main = NA, xlab = "Elevação (m)", ylab = "Frequência")
```

---

# 5.7 Interação raster-vetor

## 3 Estatística zonal

### Buffers

```{r}
# buffers
set.seed(42)
rc_nas_buf <- rc_nas %>% 
  dplyr::sample_n(10) %>% 
  sf::as_Spatial() %>% 
  raster::buffer(width = 1000, dissolve = FALSE) %>% 
  sf::st_as_sf()
rc_nas_buf
```

---

# 5.7 Interação raster-vetor

## 3 Estatística zonal

### Estatística zonal - Buffers

```{r}
# plot
plot(rc_nas_buf$geometry, col = adjustcolor("steelblue", .7), pch = 20, main = NA, axes = TRUE, graticule = TRUE)
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 5.7 Interação raster-vetor

## 3 Estatística zonal

### Estatística zonal

```{r}
# estatistica zonal
rc_nas_buf <- rc_nas_buf %>% 
  dplyr::mutate(elev_mean = raster::extract(x = ra_rc, y = rc_nas_buf, fun = mean, na.rm = TRUE))
rc_nas_buf
```

---

# 5.7 Interação raster-vetor

## 3 Estatística zonal

### Estatística zonal

```{r}
# plot
plot(rc_nas_buf["elev_mean"], pch = 20, main = NA, axes = TRUE, graticule = TRUE)
```

---

name: 8.

class: inverse, center, middle

# 5.8 Conversão raster-vetor

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

background-image: url(img/geo_data_convert.png)
background-size: 450px
background-position: 50% 80%

# 5.8 Conversão raster-vetor

## Podemos fazer operações de conversão entre objetos vetoriais para raster e vice-versa

---

background-image: url(img/geo_rasterization.png)
background-size: 700px
background-position: 50% 60%

# 5.8 Conversão raster-vetor

## Rasterização

---

# 5.8 Conversão raster-vetor

## Rasterização de pontos

### Rasterize

```{r}
# importar pontos
rc_nas <- sf::st_read(here::here("04_dados", "02_vetor", "SP_3543907_NASCENTES.shp"), quiet = TRUE)
rc_nas
```

---

# 5.8 Conversão raster-vetor

## Rasterização de pontos

### Rasterize

```{r}
# rasterizar pontos
rc_nas_rasterizacao <- raster::rasterize(x = rc_nas, y = ra_rc_utm23s_agre_media, field = 1, fun = "count")
rc_nas_rasterizacao
```

---

# 5.8 Conversão raster-vetor

## Rasterização de pontos

### Rasterize

```{r}
# plot
plot(rc_nas_rasterizacao, col = viridis::viridis(10))
plot(rc_nas$geometry, pch = 20, cex = .5, col = adjustcolor("gray", .5), add = TRUE)
```

---

# 5.8 Conversão raster-vetor

## Rasterização de linhas

### Rasterize

```{r}
# importar linhas
rc_hid_simp <- sf::st_read(here::here("04_dados", "02_vetor", "SP_3543907_RIOS_SIMPLES.shp"), quiet = TRUE) %>% 
  sf::st_simplify(x = ., dTolerance = 1000)
rc_hid_simp
```

---

# 5.8 Conversão raster-vetor

## Rasterização de linhas

### Rasterize

```{r}
# rasterizar linhas
rc_hid_rasterizacao <- raster::rasterize(x = rc_hid_simp,
                                         y = ra_rc_utm23s_agre_media,
                                         field = 1, fun = "count")
```

---

# 5.8 Conversão raster-vetor

## Rasterização de linhas

### Rasterize

```{r}
# plot
plot(rc_hid_rasterizacao, col = viridis::viridis(10))
plot(rc_hid_simp$geom, col = "gray", add = TRUE)
```

---

# 5.8 Conversão raster-vetor

## Rasterização de polígonos

### Rasterize

```{r}
# importar poligonos
rc_cob <- sf::st_read(here::here("04_dados", "02_vetor", "SP_3543907_USO.shp"), quiet = TRUE) %>% 
  dplyr::mutate(classe = as.factor(CLASSE_USO))
rc_cob
```

---

# 5.8 Conversão raster-vetor

## Rasterização de polígonos

### Rasterize

```{r}
# rasterizar poligonos
rc_cob_rasterizacao <- raster::rasterize(x = rc_cob, y = ra_rc_utm23s_agre_media, field = "classe")
```

---

# 5.8 Conversão raster-vetor

## Rasterização de polígonos

### Rasterize

```{r}
# plot
plot(rc_cob_rasterizacao, col = viridis::viridis(10))
plot(rc_cob$geom, add = TRUE)
```

---

background-image: url(img/geo_raster_fasterize.png)
background-size: 500px
background-position: 50% 80%

# 5.8 Conversão raster-vetor

## Rasterização de polígonos

### Fasterize

```{r}
# package fasterize
# install.packages("fasterize")
library(fasterize)
```

---

# 5.8 Conversão raster-vetor

## Rasterização de polígonos

### Fasterize

```{r}
# rasterizacao com fasterize
rc_cob_fast <- fasterize::fasterize(sf = rc_cob, raster = ra_rc_utm23s_agre_media, field = "classe")
rc_cob_fast
```

---

# 5.8 Conversão raster-vetor

## Rasterização de polígonos

### Fasterize

```{r}
# plot
plot(rc_cob_fast, col = viridis::viridis(10))
plot(rc_cob$geom, add = TRUE)
```

---

background-image: url(img/geo_raster_vectorization_points.png)
background-size: 700px
background-position: 50% 70%

# 5.8 Conversão raster-vetor

## Vetorização - Raster para pontos

---

# 5.8 Conversão raster-vetor

## Vetorização - Raster para pontos

```{r}
# vetorizacao de pontos
ra_rc_utm23s_agre_media_pontos <- raster::rasterToPoints(ra_rc_utm23s_agre_media, spatial = TRUE) %>% 
  sf::st_as_sf()
ra_rc_utm23s_agre_media_pontos
```

---

# 5.8 Conversão raster-vetor

## Vetorização - Raster para pontos

```{r}
# plot
plot(ra_rc_utm23s_agre_media, col = viridis::viridis(10, alpha = .8))
plot(ra_rc_utm23s_agre_media_pontos, pch = 20, cex = .7, main = FALSE, add = TRUE)
plot(rc_2019_utm23s$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

background-image: url(img/geo_raster_vectorization_lines_contour.png)
background-size: 800px
background-position: 50% 70%

# 5.8 Conversão raster-vetor

## Vetorização - Raster para linhas

---

# 5.8 Conversão raster-vetor

## Vetorização - Raster para linhas

```{r}
# vetorizacao de linhas
ra_rc_utm23s_agre_media_linhas <- raster::rasterToContour(x = ra_rc_utm23s_agre_media) %>% 
  sf::st_as_sf()
ra_rc_utm23s_agre_media_linhas
```

---

# 5.8 Conversão raster-vetor

## Vetorização - Raster para linhas

```{r}
# plot
plot(ra_rc_utm23s_agre_media, col = viridis::viridis(10, alpha = .8))
contour(ra_rc_utm23s_agre_media, levels =  seq(500, 900, by = 50),
        col = "white", pch = 20, lwd = 1.5, labcex = 2, main = FALSE, add = TRUE)
plot(rc_2019_utm23s$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

background-image: url(img/geo_raster_vectorization_polygons.png)
background-size: 1000px
background-position: 50% 70%

# 5.8 Conversão raster-vetor

## Vetorização - Raster para polígonos

---

# 5.8 Conversão raster-vetor

## Vetorização - Raster para polígonos

```{r}
# vetorizacao de poligonos
rc_cob_rasterizacao_poligonos <- raster::rasterToPolygons(rc_cob_rasterizacao) %>% 
  sf::st_as_sf()
rc_cob_rasterizacao_poligonos
```

---

# 5.8 Conversão raster-vetor

## Vetorização - Raster para polígonos

```{r}
# plot
plot(rc_cob_rasterizacao, col = viridis::viridis(10))
plot(rc_cob_rasterizacao_poligonos$geometry, col = NA, border = "gray", lwd = 1, main = FALSE, add = TRUE)
```

---

# 5.8 Conversão raster-vetor

## Vetorização - Raster para polígonos dissolvidos

```{r}
# vetorizacao de poligonos dissolvendo
rc_cob_rasterizacao_poligonos_dissolvidos <- raster::rasterToPolygons(rc_cob_rasterizacao, dissolve = TRUE) %>% 
  sf::st_as_sf()
rc_cob_rasterizacao_poligonos_dissolvidos
```

---

# 5.8 Conversão raster-vetor

## Vetorização - Raster para polígonos dissolvidos

```{r}
# plot
plot(rc_cob_rasterizacao, col = viridis::viridis(10))
plot(rc_cob_rasterizacao_poligonos_dissolvidos$geometry, col = NA, border = "gray", lwd = 1, main = FALSE, add = TRUE)
```

---

name: 9.

class: inverse, center, middle

# 5.9 Índices espectrais

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

background-image: url(img/geo_sr_spectral_index.png)
background-size: 600px
background-position: 70% 90%

# 5.9 Índices espectrais

## **Definição**

### Equação matemática aplicada em várias bandas espectrais de uma imagem por pixel, cuja finalidade é realçar alguma característica na imagem

## **Aplicações**

### Vegetação
### Solo
### Incêndios
### Água
### ....

---

background-image: url(img/geo_sr_spectral_index_list.png)
background-size: 500px
background-position: 50% 70%

# 5.9 Índices espectrais

## Lista de índices espectrais (infinita...)

---

background-image: url(img/geo_sr_ndvi.png), url(img/geo_sr_ndvi_response2.jpg), url(img/ndvi.jpg)
background-size: 300px, 550px, 350px 
background-position: 20% 90%, 85% 90%, 95% 15%

# 5.9 Índices espectrais

## *Normalized Difference Vegetation Index* (NDVI)

- Os valores do NDVI variam de -1 a +1

- Valores **próximos de 1** indicam **maior atividade fotossintética** da vegetação

- Valores **próximos de 0** são geralmente **áreas sem vegetação**

- Valores **próximos de -1** geralmente indicam **água**

---

background-image: url(img/geo_sr_landsat8.png), url(img/geo_sr_ndvi_response3.png), url(img/geo_sr_ndvi.jpg)
background-size: 300px, 550px, 550px
background-position: 20% 20%, 6% 83%, 92% 71%

# 5.9 Índices espectrais

## *Normalized Difference Vegetation Index* (NDVI)

---

# 5.9 Índices espectrais

## *Normalized Difference Vegetation Index* (NDVI)

### Landsat 8 - Rio Claro/SP

```{r}
# landsat 8 - Rio Claro/SP
landsat_rc
```

---

# 5.9 Índices espectrais

## *Normalized Difference Vegetation Index* (NDVI)

### Landsat 8 - Rio Claro/SP

```{r}
# plot - cores naturais
plotRGB(landsat_rc, r = 4, g = 3, b = 2, stretch = "hist")
```

---

# 5.9 Índices espectrais

## *Normalized Difference Vegetation Index* (NDVI)

### Landsat 8 - Rio Claro/SP

```{r}
# plot - falsa cor infravermelho
plotRGB(landsat_rc, r = 5, g = 4, b = 3, stretch = "hist")
```

---

background-image: url(img/geo_sr_rstbx.png), url(img/geo_sr_rstbx_image.png)
background-size: 250px, 650px
background-position: 13% 73%, 80% 85%

# 5.9 Índices espectrais

## *Normalized Difference Vegetation Index* (NDVI)

### Pacote *RStoolbox*

```{r}
# package RStoolbox
# install.packages("RStoolbox")
library(RStoolbox)
```

<br><br><br><br><br><br><br><br><br>

[*] http://bleutner.github.io/RStoolbox/

---

# 5.9 Índices espectrais

## *Normalized Difference Vegetation Index* (NDVI)

```{r}
# ndvi
landsat_rc_ndvi <- RStoolbox::spectralIndices(img = landsat_rc, red = 4, nir = 5, indices = "NDVI")
landsat_rc_ndvi
```

---

# 5.9 Índices espectrais

## *Normalized Difference Vegetation Index* (NDVI)

```{r out.width='40%'}
# plot
plot(landsat_rc_ndvi)
```

---

name: 10.

class: inverse, center, middle

# 5.10 Exportar dados matriciais

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

background-image: url(img/general_directory.png)
background-size: 300px
background-position: 50% 90%

# 5.10 Exportar dados matriciais

## Exportar raster

### Criar um diretório

```{r}
# diretorio
dir.create(here::here("04_dados", "03_raster", "exportados"))
```

---


background-image: url(img/geo_raster_single_raster.png)
background-size: 250px
background-position: 50% 90%

# 5.10 Exportar dados matriciais

## Exportar raster

```{r eval=FALSE}
# exportar raster layer
raster::writeRaster(ra_rc, 
                    filename = here::here("04_dados", "03_raster", "exportados", "elevation_rio_claro"),
                    format = "GTiff",
                    datatype = "INT2S",
                    options = c("COMPRESS=DEFLATE", "TFW=YES"),
                    progress = "text",
                    overwrite = TRUE)
```

---

background-image: url(img/geo_raster_multi_raster.png)
background-size: 230px
background-position: 50% 95%

# 5.10 Exportar dados matriciais

## Exportar stack ou brick

```{r eval=FALSE}
# exportar raster stack ou brick
raster::writeRaster(x = st[[1:3]], 
                    filename = here::here("04_dados", "03_raster", "exportados", names(st[[1:3]])),
                    bylayer = TRUE, 
                    format = "GTiff",
                    datatype = "INT2S",
                    options = c("COMPRESS=DEFLATE", "TFW=YES"),
                    progress = "text",
                    overwrite = TRUE)
```

---

class: inverse, middle, center

# Dúvidas?

---

class: clear, middle
background-image: url(img/gif_frog.gif),url(img/gif_frogs.gif), url(img/package_xaringan.png)
background-size: 250px, 500px, 130px
background-position: 35% 50%, 90% 55%, 5% 86%

## Maurício Vancine

<br><br>

Contatos:

`r icons::icon_style(icons::fontawesome(name = "envelope", style = "solid"), fill = "#23373b")` [mauricio.vancine@gmail.com]()  
`r icons::icon_style(icons::fontawesome("twitter"), fill = "#23373b")` [@mauriciovancine](https://twitter.com/mauriciovancine)  
`r icons::icon_style(icons::fontawesome(name = "github"), fill = "#23373b")` [mauriciovancine](https://github.com/mauriciovancine)
`r icons::icon_style(icons::fontawesome(name = "link", style = "solid"), fill = "#23373b")` [mauriciovancine.github.io](https://mauriciovancine.github.io)

<br><br><br><br><br>

Slides criados via pacote [xaringan](https://github.com/yihui/xaringan) e tema [Metropolis](https://github.com/pat-s/xaringan-metropolis). Animação dos sapos por [@probzz](https://twitter.com/probzz/status/1367613720294170627).