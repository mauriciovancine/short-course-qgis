---
title: "Introdução ao uso de dados geoespaciais no R <br><br><br>"
subtitle: "6 Visualização de dados geoespaciais (mapas) <br><br><br>"
author: "Maurício H. Vancine"
date: "19/06/2021"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts, custom.css]
    lib_dir: libs
    nature:
      highlightStyle: rainbow
      highlightLines: false
      highlightSpans: true
      countIncrementalSlides: false
      ratio: "16:9"
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)

knitr::opts_chunk$set(fig.retina = 3, 
                      fig.align = "center", 
                      out.width = "30%",
                      warning = FALSE, 
                      message = FALSE,
                      eval = TRUE)

library(knitr)
library(tidyverse)
library(sf)
library(raster)
library(ggspatial)
library(tmap)
library(leaflet)
```

class: clear
background-image: url(img/geo_map_elements.png)
background-size: 800px

---

background-image: url(img/package_ggplot2.png), url(img/package_tmap.png), url(img/package_leaflet.png)
background-size: 250px, 250px, 250px
background-position: 73% 30%, 45% 90%, 90% 90%

# 6 Visualização de dados geoespaciais (mapas)

## Conteúdo

<br>

[6.1 Principais elementos de um mapa](#1.) <br>
[6.2 Pacotes para produção de mapas](#2.) <br>
[6.3 Mapas estáticos](#3.) <br>
[6.4 Mapas animados](#4.) <br>
[6.5 Mapas interativos](#5.) <br>

---

name: 1.

class: inverse, center, middle

# 6.1 Principais elementos de um mapa

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

# 6 Visualização de dados geoespaciais (mapas)

## Script

<br><br><br><br>

## .center[`06_script_intro_geodata_r.R`]

---

background-image: url(img/geo_map_elements.png)
background-size: 700px
background-position: 80% 60%

# 6.1 Principais elementos de um mapa

## Elementos 

1. Mapa principal
1. Mapa secundário
1. Título
1. Legenda
1. Barra de escala
1. Orientação (Norte)
1. Gride de coordenadas
1. Descrição do CRS
1. Fontes
1. Outros elementos auxiliares

---

name: 2.

class: inverse, center, middle

# 6.2 Pacotes para produção de mapas

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

# 6.2 Pacotes para produção de mapas

## Pacotes

### Principais pacotes para produção de mapas no R

<br>

|                                                            |                                                             |
|------------------------------------------------------------|-------------------------------------------------------------|
| [tmap](https://mtennekes.github.io/tmap/)                  | Mapas temáticos                                             |
| [ggplot2](https://ggplot2.tidyverse.org/)                  | Cria mapas elegantes usando a Gramática de Gráficos           |
| [ggspatial](https://paleolimbot.github.io/ggspatial/)      | Estrutura de dados espaciais para ggplot2                   |
| [leaflet](http://rstudio.github.io/leaflet/)               | Cria Web Maps interativos com Leaflet                      |
| [cartography](http://riatelab.github.io/cartography/docs/) | Cartografia temática                                        |
| [googleway](http://symbolixau.github.io/googleway/)        | Acessa Google Maps APIs para recuperar dados e traçar mapas |
| [plotly](https://plotly.com/r/maps/)                       | Crie gráficos interativos da Web por meio de ‘plotly.js’    |
| [rasterVis](https://oscarperpinan.github.io/rastervis/)    | Métodos de visualização para dados raster                   |

---

name: 3.

class: inverse, center, middle

# 6.3 Mapas estáticos

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

background-image: url(img/geo_map_tmap.png)
background-size: 650px
background-position: 80% 80%

# 6.3 Mapas estáticos

## Mapas estáticos são mapas simples e fixos para visualização de dados

## **Três principais**

### 1. `plot()` (vários pacotes)

### 2. *ggplot2*

### 3. *tmap*

---

# 6.3 Mapas estáticos

## Função `plot()`

```{r}
# biomas
biomas <- geobr::read_biomes(showProgress = FALSE) %>%
  dplyr::filter(name_biome != "Sistema Costeiro")
biomas
```

---

# 6.3 Mapas estáticos

## Função `plot()`

```{r}
# plot
plot(biomas)
```

---

# 6.3 Mapas estáticos

## Função `plot()`

```{r}
# plot
plot(biomas$geom, 
     col = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"),
     main = "Biomas do Brasil", axes = TRUE, graticule = TRUE)
legend(x = -69, y = -21, pch = 15, cex = .7, pt.cex = 2.5, legend = biomas$name_biome, 
       col = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"))
```

---

# 6.3 Mapas estáticos

## Função `plot()`

```{r}
# rio claro
rc_2019 <- geobr::read_municipality(code_muni = 3543907, year = 2019, showProgress = FALSE) %>% 
  sf::st_transform(crs = 4326)
rc_2019
```

---

# 6.3 Mapas estáticos

## Função `plot()`

```{r}
# importar raster
ra_rc <- raster::raster(here::here("04_dados", "03_raster", "srtm_27_17.tif")) %>% 
  raster::crop(rc_2019)
ra_rc
```

---

# 6.3 Mapas estáticos

## Função `plot()`

```{r}
# plot
plot(ra_rc)
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 6.3 Mapas estáticos

## Função `plot()`

```{r}
# plot
plot(ra_rc, col = viridis::viridis(100))
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
```

---

# 6.3 Mapas estáticos

## Função `plot()`

```{r}
# listar arquivos
fi <- dir(path = here::here("04_dados", "03_raster"), pattern = "wc", full.names = TRUE) %>% 
  grep(".tif", ., value = TRUE)

# importar
st <- raster::stack(fi)
st
```

---

# 6.3 Mapas estáticos

## Função `plot()`

```{r fig.width=10, fig.height=5, out.height='70%', out.width='70%'}
# plot
plot(st[[1:2]], col = viridis::viridis(10))
```

---

# 6.3 Mapas estáticos

## Função `plot()`

```{r eval=FALSE}
# diretorio
dir.create(here::here("04_dados", "05_mapas"))

# exportar mapa
png(filename = here::here("dados", "mapas", "ra_rc_rc.png"), 
    width = 20, height = 20, units = "cm", res = 300)
plot(ra_rc)
plot(rc_2019$geom, col = NA, border = "red", lwd = 2, add = TRUE)
dev.off()
```

---

background-image: url(img/cover_grammar_graphics.jpg),url(img/ggplot2_structure.png)
background-size: 230px,650px
background-position: 10% 56%, 80% 55%

# 6.3 Mapas estáticos

## The Grammar of Graphics (1999)

Os pacotes `ggplot2` e `tmap` implementam uma adaptação da **gramática dos gráficos** em "layers"

<br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://medium.com/tdebeus/think-about-the-grammar-of-graphics-when-improving-your-graphs-18e3744d8d18

---

class: clear
background-image: url(img/package_ggplot2.png)
background-size: 400px
background-position: 50% 50%

---

background-image: url(img/stats_illustrations_ggplot2_obra_prima_pt.png)
background-size: 500px
background-position: 80% 80%

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

### Integrado ao **tidyverse**, possui uma sintaxe própria

### Principal pacote para **visualização de dados** no R

### Estrutura:

`ggplot(...) +`<br>
`aes(...) +`<br>
`geom_(...) +`<br>
`stats_(...) +`<br>
`coord_(...) +`<br>
`facet_(...) +`<br>
`theme_(...)`<br>

Fonte: [@allison_horst](https://twitter.com/allison_horst)

[*] https://ggplot2.tidyverse.org/

---

background-image: url(img/plot_ggplot.gif)
background-size: 750px
background-position: 50% 50%

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

<br><br><br><br><br><br><br><br><br><br><br><br><br><br>

Fonte: https://medium.com/tdebeus/think-about-the-grammar-of-graphics-when-improving-your-graphs-18e3744d8d18

---

background-image: url(img/cheatsheet_ggplot2.png)
background-size: 600px
background-position: 50% 50%

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf

---

background-image: url(img/cover_ggplot2.jpg)
background-size: 230px
background-position: 50% 63%

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

### **ggplot2 (2009, 2016)**

<br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://ggplot2-book.org/

---

background-image: url(img/cover_r_graphics_cookbook.jpg)
background-size: 250px
background-position: 50% 63%

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

### **R Graphics Cookbook (2018)**

<br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] http://www.cookbook-r.com/Graphs/

---

background-image: url(img/cover_data_visualization_with_r.png)
background-size: 230px
background-position: 50% 65%

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

### **Data Visualization with R (2018)**

<br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://rkabacoff.github.io/datavis/

---

background-image: url(img/cover_fundamentals_of_data_visualization.png)
background-size: 260px
background-position: 50% 63%

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

### **Fundamentals of Data Visualization (2019)**

<br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://serialmentor.com/dataviz/

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r}
# dados
ggplot() +
  geom_sf(data = biomas)
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r}
# cor e preenchimento
ggplot() +
  geom_sf(data = biomas, color = "black", fill = NA)
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r}
# cor e preenchimento
ggplot() +
  geom_sf(data = biomas, aes(color = name_biome), fill = NA)
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r}
# cor e preenchimento
ggplot() +
  geom_sf(data = biomas, aes(fill = name_biome), color = NA)
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r}
# definir cor
ggplot() +
  geom_sf(data = biomas, aes(fill = name_biome), color = NA) +
  scale_fill_manual(values = c("darkgreen", "orange", "orange4", 
                               "forestgreen", "yellow", "yellow3"))
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r}
# tema
ggplot() +
  geom_sf(data = biomas, aes(fill = name_biome), color = NA) +
  scale_fill_manual(values = c("darkgreen", "orange", "orange4", 
                               "forestgreen", "yellow", "yellow3")) +
  theme_bw()
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r eval=FALSE}
# barra de escala e norte
ggplot() +
  geom_sf(data = biomas, aes(fill = name_biome), color = NA) +
  scale_fill_manual(values = c("darkgreen", "orange", "orange4", 
                               "forestgreen", "yellow", "yellow3")) +
  theme_bw() +
  annotation_scale(location = "br") +
  annotation_north_arrow(location = "br", which_north = "true",
                         pad_x = unit(0, "cm"), pad_y = unit(.5, "cm"),
                         style = north_arrow_fancy_orienteering)
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r echo=FALSE, out.width='50%'}
# barra de escala e norte
ggplot() +
  geom_sf(data = biomas, aes(fill = name_biome), color = NA) +
  scale_fill_manual(values = c("darkgreen", "orange", "orange4", 
                               "forestgreen", "yellow", "yellow3")) +
  theme_bw() +
  annotation_scale(location = "br") +
  annotation_north_arrow(location = "br", which_north = "true",
                         pad_x = unit(0, "cm"), pad_y = unit(.5, "cm"),
                         style = north_arrow_fancy_orienteering)
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r eval=FALSE}
# nomes e anotacoes
ggplot(data = biomas) +
  aes(fill = name_biome) +
  geom_sf(color = "black") +
  scale_fill_manual(values = c("darkgreen", "orange", "orange4", 
                               "forestgreen", "yellow", "yellow3")) +
  annotation_scale(location = "br") +
  annotation_north_arrow(location = "br", which_north = "true",
                         pad_x = unit(0, "cm"), pad_y = unit(.5, "cm"),
                         style = north_arrow_fancy_orienteering) +
  annotate(geom = "text", label = "CRS: SIRGAS2000/Geo", x = -38, y = -31, size = 2.5) +
  annotate(geom = "text", label = "Fonte: IBGE (2019)", x = -39, y = -32.5, size = 2.5) +
  labs(title = "Biomas do Brasil", fill = "Legenda", x = "Longitude", y = "Latitude") +
  theme_bw() +
  theme(title = element_text(size = 15, face = "bold"),
        legend.title = element_text(size = 10, face = "bold"),
        legend.position = c(.15, .25),
        legend.background = element_rect(colour = "black"),
        axis.title = element_text(size = 10, face = "plain"))
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r echo=FALSE, out.width='45%'}
# nomes e anotacoes
ggplot(data = biomas) +
  aes(fill = name_biome) +
  geom_sf(color = "black") +
  scale_fill_manual(values = c("darkgreen", "orange", "orange4", 
                               "forestgreen", "yellow", "yellow3")) +
  annotation_scale(location = "br") +
  annotation_north_arrow(location = "br", which_north = "true",
                         pad_x = unit(0, "cm"), pad_y = unit(.5, "cm"),
                         style = north_arrow_fancy_orienteering) +
  annotate(geom = "text", label = "CRS: SIRGAS2000/Geo", x = -38, y = -31, size = 2.5) +
  annotate(geom = "text", label = "Fonte: IBGE (2019)", x = -39, y = -32.5, size = 2.5) +
  labs(title = "Biomas do Brasil", fill = "Legenda", x = "Longitude", y = "Latitude") +
  theme_bw() +
  theme(title = element_text(size = 15, face = "bold"),
        legend.title = element_text(size = 10, face = "bold"),
        legend.position = c(.15, .25),
        legend.background = element_rect(colour = "black"),
        axis.title = element_text(size = 10, face = "plain"))
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r eval=FALSE}
# atribuicao
map_biomas_ggplot2 <- ggplot(data = biomas) +
  aes(fill = name_biome) +
  geom_sf(color = "black") +
  scale_fill_manual(values = c("darkgreen", "orange", "orange4", 
                               "forestgreen", "yellow", "yellow3")) +
  annotation_scale(location = "br") +
  annotation_north_arrow(location = "br", which_north = "true",
                         pad_x = unit(0, "cm"), pad_y = unit(.5, "cm"),
                         style = north_arrow_fancy_orienteering) +
  annotate(geom = "text", label = "CRS: SIRGAS2000/Geo", x = -38, y = -31, size = 2.5) +
  annotate(geom = "text", label = "Fonte: IBGE (2019)", x = -39, y = -32.5, size = 2.5) +
  labs(title = "Biomas do Brasil", fill = "Legenda", x = "Longitude", y = "Latitude") +
  theme_bw() +
  theme(title = element_text(size = 15, face = "bold"),
        legend.title = element_text(size = 10, face = "bold"),
        legend.position = c(.15, .25),
        legend.background = element_rect(colour = "black"),
        axis.title = element_text(size = 10, face = "plain"))
map_biomas_ggplot2
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r echo=FALSE, out.width='45%'}
# atribuicao
map_biomas_ggplot2 <- ggplot(data = biomas) +
  aes(fill = name_biome) +
  geom_sf(color = "black") +
  scale_fill_manual(values = c("darkgreen", "orange", "orange4", 
                               "forestgreen", "yellow", "yellow3")) +
  annotation_scale(location = "br") +
  annotation_north_arrow(location = "br", which_north = "true",
                         pad_x = unit(0, "cm"), pad_y = unit(.5, "cm"),
                         style = north_arrow_fancy_orienteering) +
  annotate(geom = "text", label = "CRS: SIRGAS2000/Geo", x = -38, y = -31, size = 2.5) +
  annotate(geom = "text", label = "Fonte: IBGE (2019)", x = -39, y = -32.5, size = 2.5) +
  labs(title = "Biomas do Brasil", fill = "Legenda", x = "Longitude", y = "Latitude") +
  theme_bw() +
  theme(title = element_text(size = 15, face = "bold"),
        legend.title = element_text(size = 10, face = "bold"),
        legend.position = c(.15, .25),
        legend.background = element_rect(colour = "black"),
        axis.title = element_text(size = 10, face = "plain"))
map_biomas_ggplot2
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r}
# dados
ra_rc_da <- raster::rasterToPoints(ra_rc) %>% 
  tibble::as_tibble()
head(ra_rc_da)
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r eval=FALSE}
# plot
map_ra_rc_ggplot2 <- ggplot() +
  geom_raster(data = ra_rc_da, aes(x = x, y = y, fill = srtm_27_17)) +
  geom_sf(data = rc_2019, color = "red", fill = NA, size = 1.3) +
  scale_fill_viridis_c() +
  coord_sf() +
  annotation_scale(location = "br",
                   pad_x = unit(.5, "cm"), pad_y = unit(.7, "cm"),) +
  annotation_north_arrow(location = "br", which_north = "true",
                         pad_x = unit(.4, "cm"), pad_y = unit(1.3, "cm"),
                         style = north_arrow_fancy_orienteering) +
  annotate(geom = "text", label = "CRS: WGS84/Geo", x = -47.51, y = -22.53, size = 3) +
  labs(title = "Elevação de Rio Claro/SP", fill = "Elevação (m)", x = "Longitude", y = "Latitude") +
  theme_bw() +
  theme(title = element_text(size = 15, face = "bold"),
        legend.title = element_text(size = 10, face = "bold"),
        legend.position = c(.2, .25),
        legend.background = element_rect(colour = "black"),
        axis.title = element_text(size = 10, face = "plain"),
        axis.text.y = element_text(angle = 90, hjust = .4))
map_ra_rc_ggplot2
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r echo=FALSE, out.width='40%'}
# plot
map_ra_rc_ggplot2 <- ggplot() +
  geom_raster(data = ra_rc_da, aes(x = x, y = y, fill = srtm_27_17)) +
  geom_sf(data = rc_2019, color = "red", fill = NA, size = 1.3) +
  scale_fill_viridis_c() +
  coord_sf() +
  annotation_scale(location = "br",
                   pad_x = unit(.5, "cm"), pad_y = unit(.7, "cm"),) +
  annotation_north_arrow(location = "br", which_north = "true",
                         pad_x = unit(.4, "cm"), pad_y = unit(1.3, "cm"),
                         style = north_arrow_fancy_orienteering) +
  annotate(geom = "text", label = "CRS: WGS84/Geo", x = -47.51, y = -22.53, size = 3) +
  labs(title = "Elevação de Rio Claro/SP", fill = "Elevação (m)", x = "Longitude", y = "Latitude") +
  theme_bw() +
  theme(title = element_text(size = 15, face = "bold"),
        legend.title = element_text(size = 10, face = "bold"),
        legend.position = c(.2, .25),
        legend.background = element_rect(colour = "black"),
        axis.title = element_text(size = 10, face = "plain"),
        axis.text.y = element_text(angle = 90, hjust = .4))
map_ra_rc_ggplot2
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r eval=FALSE}
# exportar
ggsave(
  filename = here::here("04_dados", "05_mapas", "map_biomas_ggplot2.png"),
  plot = map_biomas_ggplot2, 
  width = 20, 
  height = 20, 
  units = "cm", 
  dpi = 300
)
```

```{r echo=FALSE, out.width='25%'}
map_biomas_ggplot2
```

---

# 6.3 Mapas estáticos

## **ggplot2** e **ggspatial**

```{r eval=FALSE}
# exportar
ggsave(
  filename = here::here("04_dados", "05_mapas", "ra_rc_rc_ggplot2.png"), 
  plot = map_ra_rc_ggplot2, 
  width = 20, 
  height = 20, 
  units = "cm", 
  dpi = 300
)
```

```{r echo=FALSE, out.width='25%'}
map_ra_rc_ggplot2
```

---

class: clear
background-image: url(img/package_tmap.png)
background-size: 400px
background-position: 50% 50%

---

background-image: url(img/geo_tmap_article.png)
background-size: 350px
background-position: 50% 85%

# 6.3 Mapas estáticos

## **tmap**

### Artigo

> - Tennekes, Martijn. ["tmap: Thematic Maps in R."](https://www.jstatsoft.org/article/view/v084i06) Journal of Statistical Software 84.06 (2018): 1-39.

---

background-image: url(img/geo_tmap_classic.png)
background-size: 600px
background-position: 80% 80%

# 6.3 Mapas estáticos

## **tmap**

### Sintaxe baseada no **ggplot2** e na **Gramática dos Gráficos**

### Dois modos: **plot** (estáticos) e **visualização** (interativos)

### Estrutura:

`tm_shape(...) +`<br>
`tm_*(...) +`<br>
`tm_facets(...) +`<br>
`tm_layout(...)`<br>

`tm_style(...)`<br>
`tmap_arrange(...)`<br>
`tm_mode(...)`<br>

[*] https://mtennekes.github.io/tmap/

---

background-image: url(img/cover_geocompr.png)
background-size: 230px
background-position: 50% 65%

# 6.3 Mapas estáticos

## **tmap**

### **Geocomputation with R (2019)**

<br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://geocompr.robinlovelace.net/adv-map.html

---

background-image: url(img/geo_tmap_ggplot01.png),url(img/geo_tmap_ggplot02.png)
background-size: 700px,550px
background-position: 50% 20%,50% 90%

# 6.3 Mapas estáticos

## **ggplot2** e **tmap**

---

# 6.3 Mapas estáticos

## **tmap**

```{r}
# poligonos
tm_shape(biomas) +
  tm_polygons()
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r}
# bordas
tm_shape(biomas) +
  tm_borders()
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r}
# prenchimento
tm_shape(biomas) +
  tm_fill()
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r}
# cores
tm_shape(biomas) +
  tm_fill(col = "name_biome", title = "Legenda")
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r eval=FALSE}
# definir cores
tm_shape(biomas) +
  tm_fill(col = "name_biome", 
          pal = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"),
          title = "Legenda")
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r echo=FALSE, out.width='40%'}
# definir cores
tm_shape(biomas) +
  tm_fill(col = "name_biome", 
          pal = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"),
          title = "Legenda")
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r eval=FALSE}
# gride coordenadas
tm_shape(biomas) +
  tm_fill(col = "name_biome", 
          pal = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"), 
          title = "Legenda") +
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90))
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r echo=FALSE, out.width='40%'}
# gride coordenadas
tm_shape(biomas) +
  tm_fill(col = "name_biome", 
          pal = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"), 
          title = "Legenda") +
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90))
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r eval=FALSE}
# barra de escala e norte
tm_shape(biomas) +
  tm_fill(col = "name_biome", 
          pal = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"), 
          title = "Legenda") +
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90)) +
  tm_compass() +
  tm_scale_bar()
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r echo=FALSE, out.width='40%'}
# barra de escala e norte
tm_shape(biomas) +
  tm_fill(col = "name_biome", 
          pal = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"), 
          title = "Legenda") +
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90)) +
  tm_compass() +
  tm_scale_bar()
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r eval=FALSE}
# nomes
tm_shape(biomas) +
  tm_fill(col = "name_biome", 
          pal = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"), 
          title = "Legenda") +
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90)) +
  tm_compass() +
  tm_scale_bar() +
  tm_xlab("Longitude") +
  tm_ylab("Latitude") +
  tm_credits("CRS: SIRGAS2000/Geo", position = c(.63, .13)) +
  tm_credits("Fonte: IBGE (2019)", position = c(.63, .09))
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r echo=FALSE, out.width='40%'}
# nomes
tm_shape(biomas) +
  tm_fill(col = "name_biome", 
          pal = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"), 
          title = "Legenda") +
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90)) +
  tm_compass() +
  tm_scale_bar() +
  tm_xlab("Longitude") +
  tm_ylab("Latitude") +
  tm_credits("CRS: SIRGAS2000/Geo", position = c(.63, .13)) +
  tm_credits("Fonte: IBGE (2019)", position = c(.63, .09))
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r eval=FALSE}
# titulos
tm_shape(biomas) +
  tm_fill(col = "name_biome", 
          pal = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"), 
          title = "Legenda") +
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90)) +
  tm_compass() +
  tm_scale_bar() +
  tm_xlab("Longitude") +
  tm_ylab("Latitude") +
  tm_credits("CRS: SIRGAS2000/Geo", position = c(.63, .13)) +
  tm_credits("Fonte: IBGE (2019)", position = c(.63, .09)) +
  tm_layout(main.title = "Biomas do Brasil",
            title.position = c(.25, .95),
            title.size = 1.8,
            title.fontface = "bold",
            legend.frame = TRUE,
            legend.position = c("left", "bottom"),
            legend.title.fontface = "bold")
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r echo=FALSE, out.width='40%'}
# titulos
tm_shape(biomas) +
  tm_fill(col = "name_biome", 
          pal = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"), 
          title = "Legenda")+
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90)) +
  tm_compass() +
  tm_scale_bar() +
  tm_xlab("Longitude") +
  tm_ylab("Latitude") +
  tm_credits("CRS: SIRGAS2000/Geo", position = c(.63, .13)) +
  tm_credits("Fonte: IBGE (2019)", position = c(.63, .09)) +
  tm_layout(main.title = "Biomas do Brasil",
            title.position = c(.25, .95),
            title.size = 1.8,
            title.fontface = "bold",
            legend.frame = TRUE,
            legend.position = c("left", "bottom"),
            legend.title.fontface = "bold")
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r eval=FALSE}
# atribuicao
map_biomas_tmap <- tm_shape(biomas) +
  tm_fill(col = "name_biome", 
          pal = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"), 
          title = "Legenda") +
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90)) +
  tm_compass() +
  tm_scale_bar() +
  tm_xlab("Longitude") +
  tm_ylab("Latitude") +
  tm_credits("CRS: SIRGAS2000/Geo", position = c(.63, .13)) +
  tm_credits("Fonte: IBGE (2019)", position = c(.63, .09)) +
  tm_layout(maintitle = "Biomas do Brasil",
            title.position = c(.25, .95),
            title.size = 1.8,
            title.fontface = "bold",
            legend.frame = TRUE,
            legend.position = c("left", "bottom"),
            legend.title.fontface = "bold")
map_biomas_tmap
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r echo=FALSE, out.width='40%'}
# atribuicao
map_biomas_tmap <- tm_shape(biomas) +
  tm_fill(col = "name_biome", 
          pal = c("darkgreen", "orange", "orange4", "forestgreen", "yellow", "yellow3"),
          title = "Legenda")+
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90)) +
  tm_compass() +
  tm_scale_bar() +
  tm_xlab("Longitude") +
  tm_ylab("Latitude") +
  tm_credits("CRS: SIRGAS2000/Geo", position = c(.63, .13)) +
  tm_credits("Fonte: IBGE (2019)", position = c(.63, .09)) +
  tm_layout(main.title = "Biomas do Brasil",
            title.position = c(.25, .95),
            title.size = 1.8,
            title.fontface = "bold",
            legend.frame = TRUE,
            legend.position = c("left", "bottom"),
            legend.title.fontface = "bold")
map_biomas_tmap
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r eval=FALSE}
# plot
map_ra_rc_tmap <- tm_shape(ra_rc) +
  tm_raster(title = "Legenda") +
  tm_shape(rc_2019) +
  tm_borders(col = "red", lwd = 2) +
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90)) +
  tm_compass() +
  tm_scale_bar() +
  tm_xlab("Longitude") +
  tm_ylab("Latitude") +
  tm_layout(legend.position = c("left", "bottom"), 
            main.title = "Elevação Rio Claro/SP")
map_ra_rc_tmap
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r echo=FALSE, out.width='40%'}
# plot
map_ra_rc_tmap <- tm_shape(ra_rc) +
  tm_raster(title = "Legenda") +
  tm_shape(rc_2019) +
  tm_borders(col = "red", lwd = 2) +
  tm_grid(lines = FALSE,
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90)) +
  tm_compass() +
  tm_scale_bar() +
  tm_xlab("Longitude") +
  tm_ylab("Latitude") +
  tm_layout(legend.position = c("left", "bottom"), 
            main.title = "Elevação Rio Claro/SP")
map_ra_rc_tmap
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r eval=FALSE}
# plot
map_ra_rc_tmap <- tm_shape(ra_rc) +
  tm_raster(pal = wesanderson::wes_palette("Zissou1"), title = "Legenda") +
  tm_shape(rc_2019) +
  tm_borders(col = "red", lwd = 2) +
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90)) +
  tm_compass() +
  tm_scale_bar() +
  tm_xlab("Longitude") +
  tm_ylab("Latitude") +
  tm_layout(legend.position = c("left", "bottom"), 
            main.title = "Elevação Rio Claro/SP")
map_ra_rc_tmap
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r echo=FALSE, out.width='40%'}
# plot
map_ra_rc_tmap <- tm_shape(ra_rc) +
  tm_raster(pal = wesanderson::wes_palette("Zissou1"), title = "Legenda") +
  tm_shape(rc_2019) +
  tm_borders(col = "red", lwd = 2) +
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""),
          labels.rot = c(0, 90)) +
  tm_compass() +
  tm_scale_bar() +
  tm_xlab("Longitude") +
  tm_ylab("Latitude") +
  tm_layout(legend.position = c("left", "bottom"), 
            main.title = "Elevação Rio Claro/SP")
map_ra_rc_tmap
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r eval=FALSE}
# plot
map_ra_rc_tmap <- tm_shape(ra_rc) +
  tm_raster(pal = cptcity::cpt(pal = "gmt_GMT_dem4"), n = 20, title = "Legenda") +
  tm_shape(rc_2019) +
  tm_borders(col = "red", lwd = 2) +
  tm_grid(lines = FALSE,
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90)) +
  tm_compass(position = c("left", "bottom")) +
  tm_scale_bar(position = c("left", "bottom")) +
  tm_xlab("Longitude") +
  tm_ylab("Latitude") +
  tm_layout(legend.outside = TRUE,
            main.title = "Elevação Rio Claro/SP")
map_ra_rc_tmap
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r echo=FALSE, out.width='50%'}
# plot
map_ra_rc_tmap <- tm_shape(ra_rc) +
  tm_raster(pal = cptcity::cpt(pal = "gmt_GMT_dem4"), 
            n = 20,
            title = "Legenda") +
  tm_shape(rc_2019) +
  tm_borders(col = "red", lwd = 2) +
  tm_grid(lines = FALSE, 
          labels.format = list(big.mark = ""), 
          labels.rot = c(0, 90)) +
  tm_compass(position = c("left", "bottom")) +
  tm_scale_bar(position = c("left", "bottom")) +
  tm_xlab("Longitude") +
  tm_ylab("Latitude") +
  tm_layout(legend.outside = TRUE,
            main.title = "Elevação Rio Claro/SP")
map_ra_rc_tmap
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r eval=FALSE}
# exportar
tmap::tmap_save(tm = map_biomas_tmap, 
                filename = here::here("04_dados", "05_mapas", "biomas_tmap.png"), 
                width = 20, 
                height = 20, 
                units = "cm", 
                dpi = 300)
```

```{r echo=FALSE, out.width='25%'}
map_biomas_tmap
```

---

# 6.3 Mapas estáticos

## **tmap**

```{r eval=FALSE}
# exportar
tmap::tmap_save(tm = map_ra_rc_tmap, 
                filename = here::here("04_dados", "05_mapas", "ra_rc_tmap.png"), 
                width = 20, 
                height = 20, 
                units = "cm", 
                dpi = 300)
```

```{r echo=FALSE, out.width='30%'}
map_ra_rc_tmap
```

---

name: 4.

class: inverse, center, middle

# 6.4 Mapas animados

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

background-image: url(img/geo_map_urban_animated.gif)
background-size: 800px
background-position: 50% 110%

# 6.4 Mapas animados

## **Mapas animados** são utilizados para entender a mudanças espaciais e/ou no tempo

---

# 6.4 Mapas animados

## Mudança dos estados do Brasil ao longo do tempo

```{r}
# dados
br_anos <- NULL
for(i in c(1872, 1900, 1911, 1920, 1933, 1940, 1950, 1960, 1970, 1980, 1991, 2001, 2010, 2019)){
  br_anos <- geobr::read_state(code_state = "all", year = i, showProgress = FALSE) %>% 
    sf::st_geometry() %>% 
    sf::st_as_sf() %>%
    dplyr::mutate(year = i) %>% 
    dplyr::bind_rows(br_anos, .)
}

# numero de estados ao longo do tempo
br_anos$year %>% table
```

---

# 6.4 Mapas animados

## Mudança dos estados do Brasil ao longo do tempo

```{r}
# mapa facetado
map_brasil_tmap <- tm_shape(br_anos) + 
  tm_polygons() + 
  tm_facets(by = "year", nrow = 4)
map_brasil_tmap
```

---

background-image: url(img/geo_br_anos.gif)
background-size: 400px
background-position: 50% 95%

# 6.4 Mapas animados

## Mudança dos estados do Brasil ao longo do tempo

```{r eval=FALSE}
# mapa animado
map_brasil_tmap_ani <- tm_shape(br_anos) + 
  tm_polygons() + 
  tm_facets(along = "year", free.coords = FALSE)
map_brasil_tmap_ani
```

---

background-image: url(img/geo_br_anos.gif)
background-size: 400px
background-position: 50% 95%

# 6.4 Mapas animados

## Mudança dos estados do Brasil ao longo do tempo

```{r eval=FALSE}
# exportar
tmap::tmap_animation(tm = map_brasil_tmap_ani, 
                     filename = here::here("04_dados", "05_mapas", "elev_rc_tmap_ani.gif"), 
                     delay = 30)
```

---

name: 5.

class: inverse, center, middle

# 6.5 Mapas interativos

.footnote[

[Slide de conteúdo](#contents-slide)

]

---

# 6.5 Mapas interativos

## **Mapas interativos** são utilizados quando precisamos interagir

<br>

```{r echo=FALSE, out.width='80%'}
include_url("img/map_int.html")
```

---

class: clear
background-image: url(img/package_tmap.png)
background-size: 400px
background-position: 50% 50%

---

# 6.5 Mapas interativos

## **tmap**

```{r eval=FALSE}
# mudar o modo de exibicao do tmap
tmap::tmap_mode(mode = "view")

# mapa interativo
map_ra_rc_tmap_int <- map_ra_rc_tmap
map_ra_rc_tmap_int
```

---

# 6.5 Mapas interativos

## **tmap**

<br>

```{r echo=FALSE, out.width='80%'}
include_url("img/geo_map_tmap.html")
```

---

# 6.5 Mapas interativos

## **tmap**

```{r eval=FALSE}
# exportar mapa tmap interativo
tmap::tmap_save(tm = map_ra_rc_tmap_int, 
                filename = here::here("dados", "mapas", "elev_rc_tmap_int.html"))
```

---

class: clear
background-image: url(img/geo_mapview.gif)
background-size: 450px
background-position: 50% 50%

---

background-image: url(img/geo_mapview.gif)
background-size: 400px
background-position: 50% 55%

# 6.5 Mapas interativos

## **mapview**

<br><br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://r-spatial.github.io/mapview/

---

# 6.5 Mapas interativos

## **mapview**

```{r eval=FALSE}
# plot
map_ra_rc_mapview_int <- mapview::mapview(ra_rc, col.regions = viridis::viridis(100))
map_ra_rc_mapview_int
```

```{r echo=FALSE, out.width='80%'}
include_url("img/geo_map_mapview.html")
```

---

background-image: url(img/geo_mapview.gif)
background-size: 350px
background-position: 50% 90%

# 6.5 Mapas interativos

## **mapview**

```{r eval=FALSE}
# exportar mapa tmap interativo
mapview::mapshot(x = map_ra_rc_mapview_int, 
                 url = here::here("04_dados", "05_mapas", "ra_rc_mapview_int.html"))
```

---

class: clear
background-image: url(img/package_leaflet.png)
background-size: 450px
background-position: 50% 50%

---

background-image: url(img/package_leaflet.png)
background-size: 350px
background-position: 50% 50%

# 6.5 Mapas interativos

## **leaflet**

<br><br><br><br><br><br><br><br><br><br><br><br><br>

[*] https://leafletjs.com/

[*] https://rstudio.github.io/leaflet/

---

# 6.5 Mapas interativos

## **leaflet**

```{r eval=FALSE}
# paleta de cores
pal <- colorNumeric(viridis::viridis(10), raster::values(ra_rc))

# mapa
map_ra_rc_leaflet_int <- leaflet() %>%
  addProviderTiles("CartoDB.Positron") %>% 
  addRasterImage(ra_rc, colors = pal, opacity = .8) %>%
  addLegend(pal = pal, values = raster::values(ra_rc), title = "Elevação (m)") %>% 
  addPolygons(data = rc_2019, col = "red", fill = NA)
map_ra_rc_leaflet_int
```

---

# 6.5 Mapas interativos

## **leaflet**

<br>

```{r echo=FALSE, out.width='80%'}
include_url("img/geo_map_leaflet.html")
```

---

background-image: url(img/package_leaflet.png)
background-size: 350px
background-position: 50% 90%

# 6.5 Mapas interativos

## **leaflet**

```{r eval=FALSE}
# exportar mapa tmap interativo
mapview::mapshot(x = map_ra_rc_leaflet_int, 
                 url = here::here("04_dados", "05_mapas", "ra_rc_leaflet_int.html"))
```

---

class: inverse, center, middle
# Gostaria de agradecer a paciência e confiança

---

class: clear, middle
background-image: url(img/gif_frog.gif),url(img/gif_frogs.gif), url(img/package_xaringan.png)
background-size: 250px, 500px, 130px
background-position: 35% 50%, 90% 55%, 5% 86%

## Maurício Vancine

<br><br>

Contatos:

`r icons::icon_style(icons::fontawesome(name = "envelope", style = "solid"), fill = "#23373b")` [mauricio.vancine@gmail.com]()  
`r icons::icon_style(icons::fontawesome("twitter"), fill = "#23373b")` [@mauriciovancine](https://twitter.com/mauriciovancine)  
`r icons::icon_style(icons::fontawesome(name = "github"), fill = "#23373b")` [mauriciovancine](https://github.com/mauriciovancine)
`r icons::icon_style(icons::fontawesome(name = "link", style = "solid"), fill = "#23373b")` [mauriciovancine.github.io](https://mauriciovancine.github.io)

<br><br><br><br><br>

Slides criados via pacote [xaringan](https://github.com/yihui/xaringan) e tema [Metropolis](https://github.com/pat-s/xaringan-metropolis). Animação dos sapos por [@probzz](https://twitter.com/probzz/status/1367613720294170627).